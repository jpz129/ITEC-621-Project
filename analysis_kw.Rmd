---
title: "analyis_kw"
author: "Katherine Westcott"
date: "3/30/2021"
output: pdf_document
---

```{r imports} 

# set up
library(tidyverse)
library(dplyr)

pan.hous <- read_csv("data/project_data.csv")[,c(2,3,4,5,6,7,8,11,35)]
pan.hous <- na.omit(pan.hous)

inc <- read_csv("/Users/kw/Desktop/Project/ITEC-621-Project/data/Unemployment.csv")
inc <- na.omit(inc)

popb <- read_csv("/Users/kw/Desktop/Project/ITEC-621-Project/data/PopulationEstimates.csv")

```

#### Adding county income and population data to project_data.csv

Median income for 2019 from

https://www.ers.usda.gov/data-products/county-level-data-sets/

```{r income}

inc <- inc %>%
  select(fips_txt, Median_Household_Income_2019, Med_HH_Income_Percent_of_State_Total_2019) %>%
  rename(county_fips = "fips_txt")

# Join

full <- inc %>%
  full_join(pan.hous, by = "county_fips")

```

Population as of 2019 from 

https://www.ers.usda.gov/data-products/county-level-data-sets/

**It would be good to find county land area data so we could use population density**

```{r Population}

# USDA Population estimate for 2019
popa <- popb %>%
  select(FIPStxt, POP_ESTIMATE_2019) 

pop <- popa %>%
  rename(county_fips = "FIPStxt")

pop$county_fips <- sub("^0+", "", pop$county_fips)
pop$county_fips <- as.double(pop$county_fips)

# Join

full <- pop %>%
  inner_join(full, by = "county_fips")

write.csv(full, file = "/Users/kw/Desktop/Project/ITEC-621-Project/data/Project_Data_pi")

```

Inspect dimensions/entries and find missing values

```{r dimensions}

length(pan.hous$county_fips)/14

```


# Inspect corr plot

```{r corr}

full.sm <- full %>%
  select(county_fips, county, state, POP_ESTIMATE_2019, Median_Household_Income_2019, date, cases, deaths, median_listing_price, active_listing_count, pending_listing_count, median_square_feet) %>%
  group_by(county_fips) %>%
  summarize(Population = mean(POP_ESTIMATE_2019), Median_Income = mean(Median_Household_Income_2019), avg_cases = mean(cases), avg_deaths = mean(deaths), avg_median_listing_price = mean(median_listing_price), avg_active_listing_count = mean(active_listing_count), avg_pending_count = mean(pending_listing_count), avg_median_sqfeet = mean(median_square_feet))

library(corrplot)

full.mat <- as.matrix(full.sm[,-1])
full.corr <- cor(full.mat)

corrplot(full.corr, method = "ellipse")

# make 3 sections: low, avg, high
sd(full$median_listing_price)

```

Mostly did this as a bird's eye view to make sure imported data makes sense. It doesn't tell us much more than what we would expect

```{r boxplot}

length(unique(full$date))
length(unique(full$county_fips))
length(unique(full$state))

colSums(is.na(full))

dim(full)




```

Omit na

```{r }

full.complete <- na.omit(full)

# find out which 4 counties are missing 

big.fips <- unique(pan.hous$county_fips)
small.fips <- unique(full.complete$county_fips)

missing.vect <- big.fips[! big.fips %in% small.fips] 

missing.fips <- pan.hous %>%
  select(county, state, county_fips) %>%
  filter(county_fips == missing.vect)

missing.fips
missing.vect

pan.hous %>%
  filter(state == "louisiana")

full.complete %>%
  filter(state == "louisiana")
  

```

